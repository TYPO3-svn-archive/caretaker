Caretaker. TYPO3-Webseiten-Überwachung

Abstract***
Eine Webseite besteht aus einer komplexen Mischung aus Hardware, Betriebssystem, und Applikationen. Bei komplexen Systemen wie TYPO3 kommen noch die verwendeten Extensions dazu. Aus diesem Grund ist es mit bestehenden Lösungen schwierig, eine solche Installation vollständig zu überwachen, insbesondere wenn sich, wie im Falle von Sicherheitsupdates, externe Randbedingungen ändern oder externe Services eingebunden sind.***

Im professionellen Webhosting wird eine möglichst kontinuierliche und lückenlose Überwachung der IT-Infrastuktur benötigt. Dies gestaltet sich jedoch bei komplexen Systemen wie großen TYPO3-Installationen, die aus vielen abhängigen Komponenten bestehen, schwierig. Zur Überwachung der Hard- und Software wird aktuell in der Regel auf Programme wie Nagios zurückgegriffen. Welche Funktionen überwacht werden, hängt hierbei oft von den Möglichkeiten der eingesetzten Überwachungssoftware ab, nicht aber von den Bedürfnissen des jeweiligen Geschäftsmodells.

Zur Überwachung der Verfügbarkeit der Webseite kommuniziert heute in der Regel ein Überwachungssystem auf einem zentralen Server mit Sensoren auf der überwachten Maschine. Somit kann der Zustand der Hardware sowie das Laufen bestimmter Prozesse verifiziert werden. Zusätzlich werden in der Regel noch ping- und http-Anfragen von außen an den Server gesendet und die Antworten ausgewertet. 

Art und Umfang der Serverüberwachung von den Fähigkeiten der verfügbaren Werkzeuge abhängig zu machen, ist allerdings ein gefährliches Vorgehen, da so leicht wichtige geschäftskritische Aspekte außer acht gelassen werden. Aus unserer Sicht sollte an erster Stelle die Analyse des jeweiligen Auftrittes und eine Identifikation der geschäftskritischen Services stehen. Darauf folgt die Festlegung, welche dieser Services überwacht werden sollen, gefolgt von der Anpassung der Überwachungssoftware. Die folgenden Punkte dienen bei der Analyse als Anhaltspunkte.

1. Verfügbarkeit: Funktioniert der Webauftritt?

Basis des Verfügbarkeitsmonitorings muss immer die Überwachung der Infrastruktur sein. Hierzu zählt neben der Hardware und Software des Webservers auch die Netzwerkanbindung und das DNS. Zusätzlich empfehlen wir für geschäftskritische Vorgänge automatisierte Integrationstests. Dabei wird eine Browsersitzung automatisiert durchlaufen, in der ein Besucher eine abgegrenzte Funktionalität der Webseite verwendet (siehe SCRUM Userstories). Hierbei ist besonders auf die thematische Abgrenzung der Tests zu achten, um im Fehlerfall schnell das Problem lokalisieren zu können.

2. Security: Ist mein Webauftritt sicher? 

Die Überwachung der Systemsicherheit beschränkt sich üblicherweise auf das Prüfen vorliegender Sicherheitsupdates auf Betriebssystemebene. Aber auch die jeweils eingesetzte CMS-Software muss einbezogen werden, wobei die jeweiligen Maßnahmen hier softwarespezifisch sind. Beispielsweise muss bei einer TYPO3-Installation die Sicherheit der installierten Extensions und des TYPO3-Cores berücksichtigt werden. 

3. Performance: Gibt es Engpässe?

Das Performance-Monitoring dient dazu, bestimmte Leistungsindikatoren kontinuierlich zu erfassen um rechtzeitig auf Änderungen reagieren zu können. Interessanter als der einzelne Wert ist hierbei die zeitliche Entwicklung. Eine grafische Darstellung ist hier unabdingbar um sinnvolle Schlussfolgerungen zu ziehen.


Diesen 3 Aspekten ist eine hohe Dynamik zu eigen, weshalb eine einfache und flexible Verwaltung der Überwachung eine weitere Grundvoraussetzung ist. Des weiteren wird eine hierarchische Strukturierung und thematische Clusterung der einzelnen Überwachungen benötigt, um in großen Webauftritten den Überblick zu behalten. Leider sind die bestehenden Überwachungssysteme in dieser Hinsicht nicht sehr flexibel, weshalb die TYPO3-Agenturen n@work/Hamburg und networkteam/Hamburg+Kiel ihre Ressourcen zusammenfassten um ein spezifisches System zur Überwachung von TYPO3-Installationen zu entwickeln.  

Entwicklungsziele für Caretaker:
1. Einfache Verwaltung der Tests (Überwachung einer Funktion) mit dem TYPO3-Backend
2. Sichere Überwachung der Interna räumlich entfernter TYPO3-Systeme
3. Einbeziehen von Integrationstests
4. Einfache Erweiterbarkeit um weitere Testmethoden
 
Entstanden ist die TYPO3-Extension Caretaker (Hausmeister), die den Kern des Testsystems bildet und für die zentrale Verwaltung, die Ausführung der Tests sowie die Aggregation und Speicherung der Ergebnisse zuständig ist. Für das Ausführen der Tests und das Anzeigen der Ergebnisse stehen ein Backend-Modul sowie ein Kommandozeilenwerkzeug zur Verfügung. In der Regel werden die Tests von einem Cronjob über die CLI-Schnittstelle ausgeführt und das Backend-Modul dient zur Pflege und Übersicht sowie zum erneuten Anstoßen von Tests, nachdem der Fehler behoben wurde. 

{Architekturgrafik}
{SCREENSHOT/DEMO CARETAKER Backend add a HTTP-Test} 
{SCREENSHOT/DEMO CARETAKER Frontend}
{Demo CLI}

Die Basis der Überwachung bildet auch bei Caretaker das Prüfen der Infrastruktur mittels SNMP (Simple Network Management Protocol), Ping und HTTP. Derzeit wird zusätzlich noch das Abfragen von Nagios Sensoren über NRPE (Nagios Remote Plugin Executor) implementiert.

Die erste Besonderheit der Überwachung einer TYPO3-basierten Webseite bildet das Prüfen der Sicherheit und Funktion der TYPO3-Installation. Die auf dem entfernten Zielsystem installierte TYPO3 Extension caretaker_instance bietet die Möglichkeit, per Fernabfrage Informationen zum TYPO3-Core, zu installierten Extensions und zur TYPO3 Konfiguration zu prüfen. Wichtig ist hierbei die sichere Verschlüsselung der Kommunikation, um unautorisiertes Abfragen von Installationsinterna zu verhindern. Als weitere Sicherheitsmaßnahme ist die Schnittstelle auf wenige atomare gut abgesicherte und ausschließlich lesende Methoden beschränkt. 

{SCREENSHOT/DEMO Extension Test Konfiguration}

Zur Unterstützung von Integrationstests wurde auf das OpenSource-Projekt Selenium zurückgegriffen. Selenium ist eine JAVA-Applikation, die einen Browser startet und beim Aufruf einer Webseite zusätzlichen Javascript Code injiziert über den die Useraktionen simuliert werden können. Durch die Java Basis kann Selenium mit vielen Zielsystemen und unterschiedlichen Browsern verwendet werden. Die Extension caretaker_selenium integriert das Selenium-Testsystem in Caretaker und stellt ein Interface zur Pflege der Tests zur Verfügung. Zur einfachen Verwaltung wurde für die Selenium IDE (Firefox Extension) ein zusätzliches Speicherformat geschaffen um die Testkonfiguration in einer leicht lesbaren Form speichern und pflegen zu können. Ihre Grenzen finden Selenium-Tests bei Layout- und CSS-Fehlern, da die Auswertung auf dem DOM und Javascript basiert. 

{SCREENSHOT/DEMO SELENIUM-IDE}
{SCREENSHOT/DEMO SELENIUM-Config}

Die verfügbaren Testmethoden sind als TYPO3-Services ausgeführt. Diese Liste kann durch weitere Extensions beliebig erweitert werden. Konsequenterweise bringt das Basissystem daher auch nur einfache Ping- und HTTP-Tests mit. Eine Stärke des Caretaker-Sytstems ist seine einfache Erweiterbarkeit. Um einen neuen Testservice hinzuzufügen muss lediglich das Konfigurations-Interface definiert werden (Flexform) und in einer PHP-Klasse eine einzelne Methode runTest implementiert werden. Für erfahrene TYPO3-Entwickler sollte eine Erweiterung des Systems daher keine Hürde darstellen.

??? abstimmen mit Klaus und HHT ???

Die Extension hat sich bereits außerhalb unseres Hauses bewährt. Als erster Kunde hat die Hamburg-Tourismus GmBh von n@work ein auf dem Caretaker System basierendes Überwachungswerkzeug für ihr Intranet in Betrieb genommen. Für weitere Kunden sind entsprechende Projekte in Vorbereitung. Insbesondere die statistische Auswertung der Messprotokolle ist für viele Kunden ein interessantes Feature da sie so oft erstmals objektive Informationen über die Verfügbarkeit ihrer Webseite erhalten.

Hinweis zum Schluss (für den Vortrag, nicht für einen Artikel): Funktioniert nur bei konstruktiven Kunde-Dienstleister-Beziehungen. Fehler wie bei UnitTests als Feature betrachten und die Tests und Timeouts so auslegen dass Fehler und Warnungen auftreten. 
